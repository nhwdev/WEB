<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>숫자 야구 게임</title>
</head>

<body>
    <h3>숫자 야구</h3>
    <div id="wrap">
        <div id="card"></div>
        <div id="left"></div>
        <input type="text" id="userNum">
        <button id="input_btn">입력</button>
    </div>
    <div id="result"></div>
    <pre>
        #userNum 입력값에 숫자를 입력하면 수 입력 버튼 클릭시
        숫자에 해당하는 num0 ~ 9 사이의 이미지를 result 출력하기
    </pre>
    <script>
        // 입력된 숫자에 해당하는 이미지 로드하기
        // document.querySelector("#input_btn").addEventListener('click', function () {
        //     let input = document.querySelector("#userNum")
        //     let inputValue = input.value
        //     let valueSplit = inputValue.split("")
        //     for (let i = 0; i < valueSplit.length; i++) {
        //         let img = document.createElement("img")
        //         img.src = `nums/num${valueSplit[i]}.jpg`
        //         document.querySelector("#card").appendChild(img)
        //     }
        // })
        // 1. 시스템이 저장하고 있는 중복되지 않은 숫자 4개를 배열로 저장하기
        let trycount = 0
        let nums = new Array(10) // 크기 10 배열 생성
        let answer = new Array(4) // 정답 저장 배열 생성
        for (let i = 0; i < nums.length; i++) { // nums 배열에 0 ~ 9 값을 저장
            nums[i] = i
        }
        // nums 배열의 요소를 섞기
        for (let a = 0; a < 10000; a++) {
            let ran = Math.floor(Math.random() * nums.length)
            let tmp = nums[0]
            nums[0] = nums[ran]
            nums[ran] = tmp
        }
        // nums 배열 중 0 ~ 3인덱스
        for (let i = 0; i < answer.length; i++) {
            answer[i] = nums[i]
        }
        console.log("answer=" + answer)
        window.onload = function () {
            document.querySelector("#input_btn").onclick = function () {
                let v_userNum = document.querySelector("#userNum").value
                // 입력 숫자 검증. 중복되지 않은 4자리 숫자를 입력
                if (!v_userNum) {
                    alert("숫자 4자리를 입력하세요")
                    document.querySelector("#userNum").focus()
                    return
                }
                // 4자리가 아닌 경우
                if (v_userNum.length != 4) {
                    alert("숫자 4자리만 입력하세요.")
                    document.querySelector("#userNum").focus()
                    return
                }
                // 숫자가 아닌 경우
                if (isNaN(v_userNum)) { // isNaN : 숫자가 아닌경우 : true 리턴
                    alert("숫자만 입력하세요.")
                    document.querySelector("#userNum").focus()
                    return
                }
                // 중복되지 않은 숫자 1
                if (isDupNum2(v_userNum)) {// 중복⭕: true, 중복❌ : false
                    alert("중복되지 않은 숫자를 입력하세요")
                    document.querySelector("#userNum").focus()
                    return
                }
                // 중복되지 않은 숫자 2
                // if (new Set(v_userNum).size !== v_userNum.length) {
                //     alert("중복되지 않은 숫자를 입력하세요")
                //     document.querySelector("#userNum").focus()
                //     return
                // }
                matchingNum(v_userNum) // S, B 결정
                document.querySelector("#userNum").value = "" // 입력칸을 초기화
            }
            // input 태그의 keyup 이벤트 등록
            document.querySelector("#userNum").onkeyup = function (event) {
                // event.keycode : 입력키의 아스키코드 값
                if (event.keyCode == 13) { // 13 : enter 키의 아스키코드 값
                    document.querySelector("#input_btn").onclick(); // 입력버튼 클릭 이벤트 핸들러 호출
                }
            }
        } // 중복 제거 기능 함수
        function isDupNum1(userNum) {
            let inputarr = userNum.split("")
            for (let i = 0; i < inputarr.length; i++) {
                if (inputarr.indexOf(inputarr[i]) !== inputarr.lastIndexOf(inputarr[i])) {
                    return true
                }
            }
            return false
        }
        function isDupNum2(userNum) {
            for (let i = 0; i < userNum.length; i++) {
                if (userNum.indexOf(userNum.charAt(i)) !== userNum.lastIndexOf(userNum.charAt(i))) {
                    return true
                }
            }
            return false
        }
        function isDupNum3(userNum) {
            let inputarr = userNum.split("")
            for (let i = 0; i < inputarr.length; i++) {
                let cnt = 0
                for (let j = 0; j < inputarr.length; j++) {
                    if (inputarr[i] == inputarr[j]) cnt++;
                }
                if (cnt > 1) return true
            }
        }
        function matchingNum(usernum) {
            // usernum : 입력된 4자리 수
            let strike = 0
            let ball = 0
            let inputarr = usernum.split("") // 배열
            // 정답과 입력된 숫자사이의 Strike, Ball을 결정하고 저장
            for (let i = 0; i < 4; i++) {
                for (let j = 0; j < 4; j++) {
                    if (answer[j] == inputarr[i]) {
                        if (i == j) strike++
                        else ball++
                    }
                }
            }
            if (strike == 4) {
                let wrap = document.querySelector("#wrap")
                let h1_1 = document.querySelector("#result").innerHTML += ("<h1>축하합니다 정답입니다</h1>")
                wrap.innerHTML += "<button id='re_btn'>다시시작</button>" // 재시작 버튼 추가
                document.querySelector("#re_btn").onclick = function () { // 재시작 클릭 이벤트 설정
                    location.reload() // 현재 페이지를 리로드
                }
                // 이미지를 #card 영역에 출력
                for (let i = 0; i < 4; i++) {
                    let img = document.createElement("img")
                    img.setAttribute("width", 100)
                    img.setAttribute("height", 100)
                    img.setAttribute("border", 1)
                    img.src = `./nums/num${answer[i]}.jpg`
                    document.querySelector("#card").append(img)
                }
            } else { // 정답이 아닌 경우
                strike += "S"
                ball += "B"
                let result_div = document.querySelector("#result")
                result_div.innerHTML += `${++trycount}번째 도전 : ${strike} ${ball}, 유저입력값 : ${usernum}<br>`
            }
        }
    </script>
</body>

</html>